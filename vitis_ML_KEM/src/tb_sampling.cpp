#include <iostream>
#include <iomanip>
#include "params.h"

// Khai báo hàm Top
void sampling_top(ap_uint<64> input_B[5], int16 coeffs_out[256]);

// Hàm Verify
bool verify(int16* hw, int16* exp, std::string name) {
    bool pass = true;
    std::cout << "Checking " << name << "... ";
    for(int i=0; i<256; i++) {
        if(hw[i] != exp[i]) {
            std::cout << "\n[FAIL] Index " << i << " HW=" << hw[i] << " Exp=" << exp[i] << std::endl;
            pass = false;
            if(i>5) break;
        }
    }
    if(pass) std::cout << "[PASS]" << std::endl;
    return pass;
}

int main() {
    std::cout << "--- TEST SAMPLING (Final) ---" << std::endl;
    
    int16 hw_out[256];
    bool all_pass = true;

    // --- CASE 1 ---
    ap_uint<64> input_case1[5] = {
        0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
    }; // Placeholder
    int16 expected_case1[256] = {
        2944, 3017, 340, 1184, 3243, 1708, 2458, 2285, 2772, 2391, 413, 258, 1833, 1537, 2203, 2680,
        3170, 1749, 2729, 266, 1070, 739, 1237, 1049, 1366, 2232, 2972, 1468, 1527, 1945, 1439, 2582,
        2711, 2209, 188, 3196, 3230, 1321, 2443, 1126, 86, 286, 107, 886, 117, 2709, 2858, 1345,
        1618, 386, 3162, 1734, 712, 2548, 709, 2832, 3205, 2085, 2901, 581, 2468, 2195, 2395, 2093,
        1863, 3028, 1559, 3180, 2035, 2340, 2317, 1189, 1288, 1285, 2201, 380, 2485, 2348, 2940, 2326,
        724, 1214, 475, 3152, 1165, 3104, 21, 2018, 1603, 840, 2640, 507, 169, 1217, 1002, 2909,
        127, 777, 1853, 312, 2220, 1311, 1603, 2490, 1396, 3292, 725, 417, 2124, 867, 1431, 3073,
        669, 1334, 200, 1324, 2595, 1839, 1710, 685, 3202, 261, 1394, 431, 2959, 1448, 274, 2486,
        374, 1680, 1068, 7, 890, 2996, 2009, 1428, 188, 321, 604, 1983, 2416, 360, 661, 1230,
        2823, 384, 317, 2382, 2986, 2644, 765, 1969, 2823, 1290, 2307, 580, 331, 2581, 2992, 2975,
        2401, 3091, 2181, 3039, 1820, 3259, 920, 1638, 1810, 538, 1737, 3015, 2100, 2345, 1706, 2604,
        2752, 1152, 499, 989, 553, 3156, 314, 2425, 2516, 2031, 199, 2037, 2922, 563, 2702, 159,
        2419, 2829, 2331, 3157, 967, 2211, 2392, 253, 1926, 1406, 1513, 2753, 1516, 2150, 188, 2660,
        1347, 2056, 399, 2670, 1877, 2362, 1153, 1266, 18, 1343, 2890, 2819, 2086, 1356, 257, 2408,
        1010, 2695, 392, 2274, 1573, 2254, 2526, 3290, 64, 1548, 2963, 120, 3195, 2896, 1339, 2465,
        1645, 3166, 2454, 1991, 1971, 1821, 839, 1721, 1794, 991, 1962, 1981, 3223, 2753, 355, 2067
    };  // Placeholder
    // [DÁN DATA TỪ PYTHON VÀO ĐÂY]
    
    sampling_top(input_case1, hw_out);
    if(!verify(hw_out, expected_case1, "Case 1")) all_pass = false;

    // --- CASE 2 ---
    ap_uint<64> input_case2[5] = {
        0x0706050403020100, 0x0f0e0d0c0b0a0908, 0x1716151413121110, 0x1f1e1d1c1b1a1918, 0x0000000000000001
    }; // Placeholder
    int16 expected_case2[256] = {
        797, 993, 161, 6, 2608, 2385, 2096, 2661, 1676, 247, 2440, 342, 634, 194, 1570, 2848,
        986, 684, 3148, 3208, 2018, 351, 2288, 612, 1394, 170, 1521, 3119, 58, 596, 2093, 1549,
        409, 2156, 1934, 1730, 1324, 388, 446, 418, 1719, 2202, 1812, 98, 1019, 2369, 214, 2699,
        28, 1523, 2824, 273, 402, 2899, 246, 210, 1288, 863, 2708, 177, 3076, 349, 44, 949,
        854, 1371, 957, 292, 2502, 1617, 1501, 254, 7, 1761, 2581, 2206, 2655, 1211, 629, 1274,
        2358, 816, 2766, 2115, 2985, 1006, 2433, 856, 2596, 3192, 1, 1378, 2345, 707, 1891, 1669,
        536, 1221, 710, 2511, 120, 1176, 322, 1897, 2309, 595, 2950, 1171, 801, 1848, 695, 2912,
        1396, 1931, 1775, 2904, 893, 2507, 1810, 2873, 253, 1529, 1047, 2615, 1687, 831, 1414, 965,
        3169, 1887, 753, 3246, 1937, 115, 2953, 586, 545, 1621, 1667, 3187, 1654, 1988, 1857, 512,
        1239, 1219, 898, 3106, 391, 1331, 2228, 3169, 586, 2412, 845, 768, 156, 662, 478, 1693,
        2632, 573, 2434, 1671, 173, 969, 364, 1663, 2701, 2169, 813, 1000, 1471, 720, 2431, 2530,
        3161, 733, 1691, 527, 2634, 335, 26, 2377, 1707, 767, 3020, 950, 502, 426, 1138, 3208,
        2607, 2389, 44, 1358, 1392, 2334, 875, 2097, 173, 1697, 2578, 942, 1817, 974, 1165, 2853,
        1958, 2973, 3282, 271, 1236, 1677, 2230, 673, 1554, 96, 242, 1729, 2518, 1884, 2272, 71,
        1382, 924, 1807, 1610, 456, 1148, 2479, 2152, 238, 2208, 2329, 713, 1175, 1196, 757, 1078,
        3190, 3169, 708, 3117, 154, 1751, 3225, 1364, 154, 23, 2842, 1105, 1419, 79, 5, 2013
    };  // Placeholder
    // [DÁN DATA TỪ PYTHON VÀO ĐÂY]

    sampling_top(input_case2, hw_out);
    if(!verify(hw_out, expected_case2, "Case 2")) all_pass = false;

    if(all_pass) {
        std::cout << "SAMPLING VERIFIED!" << std::endl;
        return 0;
    } else {
        std::cout << "SAMPLING FAILED!" << std::endl;
        return 1;
    }
}