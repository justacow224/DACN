#include <iostream>
#include "params.h"

void invntt_top(int16 poly[256]);

int main() {
    std::cout << "--- TEST INV_NTT ---" << std::endl;
    
    // [PASTE DATA TỪ PYTHON VÀO ĐÂY]
    int16 input_poly_hat[256] = {
        0, 13, 26, 39, 52, 65, 78, 91, 104, 117, 130, 143, 156, 169, 182, 195,
        208, 221, 234, 247, 260, 273, 286, 299, 312, 325, 338, 351, 364, 377, 390, 403,
        416, 429, 442, 455, 468, 481, 494, 507, 520, 533, 546, 559, 572, 585, 598, 611,
        624, 637, 650, 663, 676, 689, 702, 715, 728, 741, 754, 767, 780, 793, 806, 819,
        832, 845, 858, 871, 884, 897, 910, 923, 936, 949, 962, 975, 988, 1001, 1014, 1027,
        1040, 1053, 1066, 1079, 1092, 1105, 1118, 1131, 1144, 1157, 1170, 1183, 1196, 1209, 1222, 1235,
        1248, 1261, 1274, 1287, 1300, 1313, 1326, 1339, 1352, 1365, 1378, 1391, 1404, 1417, 1430, 1443,
        1456, 1469, 1482, 1495, 1508, 1521, 1534, 1547, 1560, 1573, 1586, 1599, 1612, 1625, 1638, 1651,
        1664, 1677, 1690, 1703, 1716, 1729, 1742, 1755, 1768, 1781, 1794, 1807, 1820, 1833, 1846, 1859,
        1872, 1885, 1898, 1911, 1924, 1937, 1950, 1963, 1976, 1989, 2002, 2015, 2028, 2041, 2054, 2067,
        2080, 2093, 2106, 2119, 2132, 2145, 2158, 2171, 2184, 2197, 2210, 2223, 2236, 2249, 2262, 2275,
        2288, 2301, 2314, 2327, 2340, 2353, 2366, 2379, 2392, 2405, 2418, 2431, 2444, 2457, 2470, 2483,
        2496, 2509, 2522, 2535, 2548, 2561, 2574, 2587, 2600, 2613, 2626, 2639, 2652, 2665, 2678, 2691,
        2704, 2717, 2730, 2743, 2756, 2769, 2782, 2795, 2808, 2821, 2834, 2847, 2860, 2873, 2886, 2899,
        2912, 2925, 2938, 2951, 2964, 2977, 2990, 3003, 3016, 3029, 3042, 3055, 3068, 3081, 3094, 3107,
        3120, 3133, 3146, 3159, 3172, 3185, 3198, 3211, 3224, 3237, 3250, 3263, 3276, 3289, 3302, 3315
    }; // Input
    int16 expected_poly[256] = {
        1651, 1664, 1097, 1097, 2048, 2048, 2001, 2001, 1134, 1134, 2450, 2450, 1470, 1470, 313, 313,
        524, 524, 2027, 2027, 329, 329, 1387, 1387, 476, 476, 1866, 1866, 2945, 2945, 1107, 1107,
        3287, 3287, 1434, 1434, 2778, 2778, 2562, 2562, 2515, 2515, 517, 517, 3055, 3055, 1530, 1530,
        629, 629, 139, 139, 659, 659, 3254, 3254, 1347, 1347, 557, 557, 1495, 1495, 122, 122,
        2338, 2338, 835, 835, 2769, 2769, 1043, 1043, 2185, 2185, 857, 857, 2416, 2416, 249, 249,
        2416, 2416, 1426, 1426, 3111, 3111, 2290, 2290, 3022, 3022, 2261, 2261, 2348, 2348, 1981, 1981,
        3188, 3188, 2675, 2675, 2020, 2020, 2368, 2368, 1320, 1320, 1669, 1669, 1932, 1932, 247, 247,
        859, 859, 1816, 1816, 2960, 2960, 1286, 1286, 1288, 1288, 3000, 3000, 1012, 1012, 1569, 1569,
        400, 400, 1569, 1569, 1012, 1012, 3000, 3000, 1288, 1288, 1286, 1286, 2960, 2960, 1816, 1816,
        859, 859, 247, 247, 1932, 1932, 1669, 1669, 1320, 1320, 2368, 2368, 2020, 2020, 2675, 2675,
        3188, 3188, 1981, 1981, 2348, 2348, 2261, 2261, 3022, 3022, 2290, 2290, 3111, 3111, 1426, 1426,
        2416, 2416, 249, 249, 2416, 2416, 857, 857, 2185, 2185, 1043, 1043, 2769, 2769, 835, 835,
        2338, 2338, 122, 122, 1495, 1495, 557, 557, 1347, 1347, 3254, 3254, 659, 659, 139, 139,
        629, 629, 1530, 1530, 3055, 3055, 517, 517, 2515, 2515, 2562, 2562, 2778, 2778, 1434, 1434,
        3287, 3287, 1107, 1107, 2945, 2945, 1866, 1866, 476, 476, 1387, 1387, 329, 329, 2027, 2027,
        524, 524, 313, 313, 1470, 1470, 2450, 2450, 1134, 1134, 2001, 2001, 2048, 2048, 1097, 1097
    };  // Expected Output
    
    // Copy input ra buffer HW
    int16 hw_poly[256];
    for(int i=0; i<256; i++) hw_poly[i] = input_poly_hat[i];
    
    invntt_top(hw_poly);
    
    bool pass = true;
    for(int i=0; i<256; i++) {
        if (hw_poly[i] != expected_poly[i]) {
            std::cout << "[FAIL] i=" << i << " HW=" << hw_poly[i] << " Exp=" << expected_poly[i] << std::endl;
            pass = false;
            if (i > 5) break;
        }
    }
    
    if (pass) std::cout << "INV_NTT PASSED!" << std::endl;
    else std::cout << "INV_NTT FAILED" << std::endl;
    
    return pass ? 0 : 1;
}